
Remove-Variable * -ErrorAction SilentlyContinue
$ProGressPreference = 'SilentlyContinue'
Add-Type -AssemblyName presentationframework
Add-Type -AssemblyName presentationcore

$itsdform = @{}
$xmlfile = Invoke-webrequest "https://raw.githubusercontent.com/ChrisSalProTools/CloudTools/main/full.txt" -usebasicparsing
$xmlfile = $xmlfile.content
$BackgroundColorChoice = get-content $env:userprofile\AppData\Local\CloudTools\Background.txt
$ButtonColorChoice = get-content $env:userprofile\AppData\Local\CloudTools\Button.txt
$BackgroundText = get-content $env:userprofile\AppData\Local\CloudTools\BackgroundText.txt
$ButtonText = get-content $env:userprofile\AppData\Local\CloudTools\ButtonText.txt
$xmlfile = $xmlfile -replace "BackgroundColorVar","$BackgroundColorChoice"
$xmlfile = $xmlfile -replace "ButtonColorVar","$ButtonColorChoice"
$xmlfile = $xmlfile -replace "BackgroundTextVar","$BackgroundText"
$xmlfile = $xmlfile -replace "ButtonTextVar","$ButtonText"
$xmlfileclean = $xmlfile -replace 'mc:Ignorable="d"','' -replace "x:N",'N' -replace 'x:Class=".*?"','' -replace 'd:DesignHeight="\d*?"','' -replace 'd:Designwidth="\d*?"',''
[xml]$xmlfile = $xmlfileclean
$reader = new-object System.Xml.XmlNodeReader $xmlfile
$tempform = [windows.markup.xamlreader]::Load($reader)
$NamedObjects = $xmlfile.selectnodes("//*[@*[contains(translate(name(.),'n','N'),'Name')]]")
$namedobjects | foreach-object {

$itsdform.Add($_.Name, $tempform.FindName($_.Name))

}
#Entire Script goes below - everything above is used to pull the GUI and make it readable
#===================================================================================

# the following module is a failsafe if someone enters an incorrect color - this will relaunch the tool with the colors reset
$testlaunch = $itsdform | out-string
$testlaunch = $testlaunch | select-string "Name"
if ($testlaunch -eq $null){
"#FF205D80" > $env:userprofile\AppData\Local\CloudTools\Background.txt
"#FFFFFF" > $env:userprofile\AppData\Local\CloudTools\Button.txt
"white" > $env:userprofile\AppData\Local\CloudTools\BackgroundText.txt
"#000000" > $env:userprofile\AppData\Local\CloudTools\ButtonText.txt
start-process powershell.exe -windowstyle hidden -argumentlist '$run = invoke-webrequest "https://raw.githubusercontent.com/ChrisSalProTools/CloudTools/main/ITSDProTools.txt" -usebasicparsing; $run = $run.content; Invoke-Expression $run'
exit
}

# Code that is executed when the Search button is clicked

$itsdform.searchButton.add_Click({
})

$itsdform.BsamButton.add_Click({
})

$itsdform.PermissionsButton.add_Click({
})

$itsdform.VerifyButton.add_Click({
$UsrInput = $itsdform.inputBox.text
$UsrInput > $env:userprofile\AppData\Local\CloudTools\outfile.txt
start-process powershell.exe -argumentlist '$run = invoke-webrequest "https://raw.githubusercontent.com/ChrisSalProTools/CloudTools/main/verify.txt" -usebasicparsing; $run = $run.content; Invoke-Expression $run'
$itsdform.inputBox.text = ""
})

$itsdform.PWButton.add_Click({
})

$itsdform.LockoutButton.add_Click({
})

$itsdform.CMSButton.add_Click({
})

$itsdform.ADMButton.add_Click({
})

$itsdform.SettingsButton.add_Click({
start-process powershell.exe -wait -windowstyle hidden -argumentlist '$settings = invoke-webrequest "https://raw.githubusercontent.com/ChrisSalProTools/CloudTools/main/settings.txt" -usebasicparsing; $settings = $settings.content; invoke-expression $settings'
start-process powershell.exe -argumentlist '$run = invoke-webrequest "https://raw.githubusercontent.com/ChrisSalProTools/CloudTools/main/CloudTools.txt" -usebasicparsing; $run = $run.content; invoke-expression $run'
exit
})

#======================================================================================
#OnTop
$itsdform.ProToolsWindow.ShowDialog() | out-null
